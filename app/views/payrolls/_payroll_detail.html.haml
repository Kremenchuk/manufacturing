-#{
-#  job: detail.job,
-#  o_m: detail.order_manufacturing,
-#  qty: detail.qty,
-#  qty_o_m: detail.order_manufacturing.used_jobs.each { |job, qty| return qty if job == detail.job},
-#  sum: detail.sum
-#  }

- @payroll_details.each_with_index do |detail, detail_counter|
  - position = detail_counter + 1
  - if detail.sum.present?
    - item_sum = Float(detail[:qty]) * Float(detail[:job].price)
  -else
    - item_sum = 0
  %tr{class: 'position_details_line', 'data-position': position}
    %td{style: 'display: none'}
      = text_field_tag "details[id][]", "{'o_m_id':'#{detail[:o_m].id}','job_id':'#{detail[:job].id}'}", id: "o_m_id_#{detail_counter}", class: 'o_m_id_class'
    %td.position{style: 'text-align: center;'}
      = label_tag 'position', position, class: 'position-label'
    %td
      = detail[:job].name
    %td
      = detail[:qty_o_m]
    %td
      = number_field_tag 'details[qty][]', detail[:qty], step: 0.001, class: 'form-control calculated_field', id: "qty_#{detail_counter}", 'data-counter': detail_counter
    %td{id: "price_#{detail_counter}"}
      = detail[:job].price
    %td.sum_field{id: "sum_#{detail_counter}", 'data-counter': detail_counter}
      = item_sum
    %td.remove_row{id: "remove_#{detail_counter}", 'data-counter': detail_counter}

